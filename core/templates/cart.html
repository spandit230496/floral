{% extends 'index.html' %}
{% load static %}
{% load custom_filters %}
{% load math_filter %}

{% block content %}

<div style="background-color: #f5fff2; min-height: 100vh; padding: 40px 0; font-family: 'Segoe UI', sans-serif;">
    <h2 style="text-align: center; color: #3e4d3a; margin-bottom: 40px;">üõí Your Cart</h2>

    {% if cart_items %}
    <table style="width: 90%; margin: 0 auto 30px auto; border-collapse: collapse; box-shadow: 0 8px 24px rgba(0,0,0,0.08); background-color: #ffffff; border-radius: 12px; overflow: hidden;">
        <thead>
            <tr style="background-color: #d8f3dc; color: #2b3d2f;">
                <th style="padding: 18px; text-align: left;">Product</th>
                <th style="padding: 18px;">Price</th>
                <th style="padding: 18px;">Quantity</th>
                <th style="padding: 18px;">Total</th>
                <th style="padding: 18px;">Remove</th>
            </tr>
        </thead>
        <tbody>
            {% for item in cart_items %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 18px;">{{ item.product.name }}</td>
                <td style="padding: 18px;">‚Çπ{{ item.product.price }}</td>
                <td style="padding: 18px; text-align: center;">
                    <form method="POST" action="{% url 'update_cart' item.id %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="decrement">
                        <button type="submit" style="padding: 6px 12px; border: none; background-color: #b7e4c7; border-radius: 5px;">‚ûñ</button>
                    </form>

                    <span style="margin: 0 10px; font-weight: 500;">{{ item.quantity }}</span>

                    <form method="POST" action="{% url 'update_cart' item.id %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="increment">
                        <button type="submit" style="padding: 6px 12px; border: none; background-color: #95d5b2; border-radius: 5px;">‚ûï</button>
                    </form>
                </td>
                <td style="padding: 18px;">‚Çπ{{ item.product.price|mul:item.quantity|floatformat:2 }}</td>
                <td style="padding: 18px; text-align: center;">
                    <form method="POST" action="{% url 'remove_from_cart' item.id %}">
                        {% csrf_token %}
                        <button type="submit" style="padding: 6px 12px; border: none; background-color: #ffb4a2; border-radius: 5px;">‚ùå</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="width: 90%; margin: 0 auto; text-align: right; margin-top: 20px;">
        <h3 style="margin-bottom: 5px;">Subtotal: ‚Çπ{{ total }}</h3>
        <h4 style="margin-bottom: 5px;">Delivery Charge: ‚Çπ{{ delivery_charge }}</h4>
        <h3 style="margin-bottom: 15px;">Grand Total: ‚Çπ{{ grand_total }}</h3>

        {% if order and order.id %}
            <!-- ‚úÖ Make checkout a pure link outside any form -->
            <a href="{% url 'checkout' order.id %}" 
               style="padding: 14px 30px; background-color: #74c69d; color: white; text-decoration: none; border-radius: 8px; font-weight: bold;">
                Proceed to Checkout
            </a>
        {% else %}
            <p>DEBUG: Order = {{ order }} | Order ID = {{ order.id }}</p>

            <button disabled 
                    style="padding: 14px 30px; background-color: #a5a5a5; color: white; border-radius: 8px; font-weight: bold;">
                Checkout Not Available
            </button>
        {% endif %}
    </div>

    {% else %}
        <p style="text-align: center; margin-top: 60px; font-size: 20px; color: #777;">Your cart is empty.</p>
    {% endif %}

</div>

{% endblock %}
